<!-- <!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë§ì¶¤í˜• ì§€ì›ì‚¬ì—… í”Œë«í¼ Â· Refactor</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#121821; --muted:#8ca0b3; --text:#e8eef5; --acc:#5cc8ff; --chip:#1b2330; --ok:#40d1a7; --warn:#ffd166;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Arial,sans-serif;background:linear-gradient(180deg,#0b0f14 0%,#0e141d 100%);color:var(--text)}
    a{color:var(--acc);text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;z-index:50;background:rgba(11,15,20,.85);backdrop-filter:blur(8px);border-bottom:1px solid #1e293b}
    .nav{display:flex;align-items:center;gap:16px;justify-content:space-between;padding:12px 24px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--acc);box-shadow:0 0 20px #38bdf8}
    .actions{display:flex;gap:10px}
    .btn{border:1px solid #2b394a;background:#0f1622;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
    .btn.acc{background:linear-gradient(90deg,#2aa1ff,#6ee7ff);color:#00131f;border:0}
    .btn.ghost{background:#0f162200;border:1px solid #2b394a}
    .btn.small{padding:6px 10px;font-size:.9rem;border-radius:10px}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .hero{padding:28px 24px 8px;border-bottom:1px solid #1e293b}
    .hero h1{margin:0 0 6px;font-size:28px}
    .muted{color:var(--muted)}

    /* Filters */
    .filters{background:var(--panel);border:1px solid #1f2a3a;border-radius:16px;padding:16px;display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin-top:16px}
    .f{display:flex;flex-direction:column;gap:8px}
    .f label{font-size:.9rem;color:#b6c5d6}
    .input,.select{background:#0f1622;border:1px solid #233041;color:var(--text);padding:10px 12px;border-radius:12px;width:100%}
    .chiprow{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:var(--chip);border:1px solid #253244;color:#c6d5e5;padding:6px 10px;border-radius:9999px;font-size:.85rem}

    /* Results */
    .toolbar{display:flex;align-items:center;justify-content:space-between;margin:18px 0}
    .results{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .card{background:var(--panel);border:1px solid #1f2a3a;border-radius:16px;padding:16px;display:flex;flex-direction:column;gap:10px}
    .title{font-weight:700;font-size:1.05rem}
    .badges{display:flex;gap:8px;flex-wrap:wrap}
    .badge{background:#0e1520;border:1px solid #273445;color:#9ec7ff;padding:4px 8px;border-radius:10px;font-size:.78rem}
    .period{font-size:.9rem}
    .period .live{color:var(--ok);font-weight:700}
    .card .row{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .card .desc{color:#c2d2e2;font-size:.95rem;line-height:1.4}

    /* Modal */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:flex-end}
    .sheet{width:100%;max-height:85vh;background:#0f1622;border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid #243347;overflow:auto}
    .sheet .hd{position:sticky;top:0;background:#0f1622;border-bottom:1px solid #243347;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
    .sheet .body{padding:16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}

    /* Pagination */
    .pagination{display:flex;gap:6px;justify-content:center;margin:20px 0}
    .page{padding:8px 12px;border-radius:10px;border:1px solid #2b394a;background:#0f1622}
    .page.active{background:var(--acc);border:0;color:#00131f;font-weight:800}

    /* Empty */
    .empty{border:1px dashed #2a3a4e;border-radius:16px;padding:24px;text-align:center;color:#adc0d4}

    footer{margin:40px 0 80px;color:#8aa0b8;text-align:center}

    /* Responsive */
    @media (max-width:1000px){.results{grid-template-columns:1fr 1fr}.grid{grid-template-columns:1fr}}
    @media (max-width:620px){.filters{grid-template-columns:1fr 1fr}.results{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand"><span class="dot" aria-hidden="true"></span><span>ë§ì¶¤í˜• ì§€ì›ì‚¬ì—… í”Œë«í¼</span></div>
      <div class="actions">
        <button class="btn ghost small" id="btn-saved" aria-pressed="false">ì €ì¥í•¨(0)</button>
        <button class="btn small" id="btn-reset">ì´ˆê¸°í™”</button>
        <button class="btn acc small" id="btn-search">ê²€ìƒ‰</button>
      </div>
    </div>
  </header>

  <section class="hero container">
    <h1>ë‹¹ì‹ ì—ê²Œ ë§ëŠ” ì§€ì›ì‚¬ì—…ì„ í•œëˆˆì—</h1>
    <p class="muted">í‚¤ì›Œë“œì™€ ì¡°ê±´ì„ ì„ íƒí•´ ë³´ì„¸ìš”. (ìƒ˜í”Œ ë°ì´í„° Â· êµ¬ì¡°í™”ëœ JSë¡œ ë¦¬íŒ©í„°ë§)</p>

    <form class="filters" id="filters" autocomplete="off" novalidate>
      <div class="f" style="grid-column: span 6">
        <label for="q">í‚¤ì›Œë“œ</label>
        <input class="input" id="q" name="q" placeholder="ì˜ˆ: ì „ì„¸ìê¸ˆ, êµìœ¡, êµí†µë¹„, ì°½ì—…" />
      </div>
      <div class="f" style="grid-column: span 3">
        <label for="region">ì§€ì—­</label>
        <select class="select" id="region" name="region">
          <option value="">ì „êµ­</option>
          <option>ì„œìš¸</option><option>ë¶€ì‚°</option><option>ëŒ€êµ¬</option><option>ì¸ì²œ</option>
          <option>ê´‘ì£¼</option><option>ëŒ€ì „</option><option>ìš¸ì‚°</option><option>ì„¸ì¢…</option>
          <option>ê²½ê¸°</option><option>ê°•ì›</option><option>ì¶©ë¶</option><option>ì¶©ë‚¨</option>
          <option>ì „ë¶</option><option>ì „ë‚¨</option><option>ê²½ë¶</option><option>ê²½ë‚¨</option>
          <option>ì œì£¼</option>
        </select>
      </div>
      <div class="f" style="grid-column: span 3">
        <label for="category">ë¶„ì•¼</label>
        <select class="select" id="category" name="category">
          <option value="">ì „ì²´</option>
          <option>ì£¼ê±°</option><option>ì¼ìë¦¬</option><option>êµìœ¡</option><option>ê¸ˆìœµ</option><option>ë³µì§€</option><option>ê¸°íƒ€</option>
        </select>
      </div>
      <div class="f" style="grid-column: span 3">
        <label for="ageMin">ë‚˜ì´(ë§Œ ê¸°ì¤€)</label>
        <div style="display:flex;gap:8px">
          <input class="input" id="ageMin" name="ageMin" inputmode="numeric" pattern="[0-9]*" min="0" placeholder="ìµœì†Œ" />
          <input class="input" id="ageMax" name="ageMax" inputmode="numeric" pattern="[0-9]*" min="0" placeholder="ìµœëŒ€" />
        </div>
      </div>
      <div class="f" style="grid-column: span 3">
        <label for="income">ì†Œë“êµ¬ê°„</label>
        <select class="select" id="income" name="income">
          <option value="">ë¬´ê´€</option>
          <option>ì¤‘ìœ„ì†Œë“ 100% ì´í•˜</option>
          <option>ì¤‘ìœ„ì†Œë“ 150% ì´í•˜</option>
          <option>ì¤‘ìœ„ì†Œë“ 200% ì´í•˜</option>
        </select>
      </div>
      <div class="f" style="grid-column: span 3">
        <label for="employment">ê³ ìš©ìƒíƒœ</label>
        <select class="select" id="employment" name="employment">
          <option value="">ë¬´ê´€</option>
          <option>ì¬ì§ì</option>
          <option>êµ¬ì§ì</option>
          <option>í”„ë¦¬ëœì„œ/ìì˜ì—…</option>
        </select>
      </div>
      <div class="f" style="grid-column: span 3">
        <label for="deadline">ë§ˆê°ì—¬ë¶€</label>
        <select class="select" id="deadline" name="deadline">
          <option value="open">ì§„í–‰ì¤‘ë§Œ</option>
          <option value="all">ì „ì²´</option>
          <option value="closed">ë§ˆê°ë§Œ</option>
        </select>
      </div>
    </form>

    <div class="chiprow" style="margin-top:12px" id="activeChips" aria-live="polite"></div>
  </section>

  <section class="container" aria-live="polite">
    <div class="toolbar">
      <div id="count" class="muted">ê²€ìƒ‰ ê²°ê³¼ 0ê±´</div>
      <div>
        <label class="sr-only" for="sort">ì •ë ¬</label>
        <select class="select" id="sort" name="sort">
          <option value="relevance">ì •í™•ë„ìˆœ</option>
          <option value="deadline">ë§ˆê° ì„ë°•ìˆœ</option>
          <option value="latest">ìµœì‹  ë“±ë¡ìˆœ</option>
        </select>
      </div>
    </div>

    <div class="results" id="results"></div>
    <div class="empty" id="empty" hidden>ì¡°ê±´ì— ë§ëŠ” ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤. í•„í„°ë¥¼ ì¡°ì •í•´ ë³´ì„¸ìš”.</div>
    <div class="pagination" id="pager"></div>
  </section>

  <div class="backdrop" id="backdrop" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="detailTitle">
      <div class="hd">
        <strong id="detailTitle">ìƒì„¸ ì •ë³´</strong>
        <button class="btn small" id="closeDetail">ë‹«ê¸°</button>
      </div>
      <div class="body" id="detailBody"></div>
    </div>
  </div>

  <footer class="container">Â© 2025 ë§ì¶¤í˜• ì§€ì›ì‚¬ì—… í”Œë«í¼ Â· ë¦¬íŒ©í„°ë§ ìƒ˜í”Œ</footer>

  <script type="module">
    // ==========================
    // ğŸ”§ Utilities
    // ==========================
    const $  = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const clampNum = (n, min, max) => Math.max(min, Math.min(max, n));
    const parseIntOr = (v, fallback) => {
      const n = parseInt(String(v).trim(), 10);
      return Number.isFinite(n) ? n : fallback;
    };
    const fmtDate = (s) => new Date(s).toISOString().slice(0,10);
    const today = () => new Date();
    const inPeriod = (p) => {
      const t = today();
      const s = new Date(p.period.start);
      const e = new Date(p.period.end);
      return t >= s && t <= e;
    };
    const debounce = (fn, ms=250) => {
      let id; return (...args)=>{ clearTimeout(id); id=setTimeout(()=>fn(...args), ms); };
    };

    // ==========================
    // ğŸ’¾ Data (mock) â€” replace with API
    // ==========================
    /** @typedef {{id:string,title:string,region:string,category:string,host:string,targets?:string,benefit?:string,period:{start:string,end:string},link:string,contact?:string,tags?:string[],minAge?:number,maxAge?:number,income?:string,employment?:string,updatedAt?:string}} Program */
    const DATA = /** @type {Program[]} */ ([
      { id:"P001", title:"ì²­ë…„ ì›”ì„¸ í•œì‹œ íŠ¹ë³„ì§€ì›", region:"ì „êµ­", category:"ì£¼ê±°", host:"êµ­í† êµí†µë¶€",
        targets:"ë§Œ 19~34ì„¸ ë¬´ì£¼íƒ ì²­ë…„", benefit:"ì›” ìµœëŒ€ 20ë§Œì›, ìµœëŒ€ 12ê°œì›” ì§€ì›",
        period:{ start:"2025-01-01", end:"2025-12-31" }, link:"https://example.com/p1", contact:"êµ­í† ë¶€ ì½œì„¼í„° 120",
        tags:["ì›”ì„¸", "ì£¼ê±°", "ì²­ë…„"], minAge:19, maxAge:34, employment:"", income:"ì¤‘ìœ„ì†Œë“ 150% ì´í•˜", updatedAt:"2025-02-10" },
      { id:"P002", title:"ì§€ì—­ ì²­ë…„ êµí†µë¹„ ì§€ì›", region:"ëŒ€êµ¬", category:"ë³µì§€", host:"ëŒ€êµ¬ê´‘ì—­ì‹œ",
        targets:"ëŒ€êµ¬ ì²­ë…„(ë§Œ 19~34ì„¸) ëŒ€ì¤‘êµí†µ ì´ìš©ì", benefit:"ì›” 3ë§Œì› ëª¨ë°”ì¼ êµí†µì¹´ë“œ ì§€ê¸‰",
        period:{ start:"2025-03-01", end:"2025-06-30" }, link:"https://example.com/p2", contact:"ëŒ€êµ¬ì‹œ ì²­ë…„ì •ì±…ê³¼",
        tags:["êµí†µë¹„", "ëŒ€ì¤‘êµí†µ"], minAge:19, maxAge:34, updatedAt:"2025-03-05" },
      { id:"P003", title:"ì²­ë…„ ì·¨ì—… ì„±ê³µ íŒ¨í‚¤ì§€(ê°€ì¹­)", region:"ê²½ë¶", category:"ì¼ìë¦¬", host:"ê²½ìƒë¶ë„",
        targets:"êµ¬ì§ ì²­ë…„", benefit:"ì·¨ì—… ì—­ëŸ‰ê°•í™” êµìœ¡ + ë©´ì ‘ë¹„/ìê²©ì¦ ë¹„ìš© ì§€ì›",
        period:{ start:"2025-01-15", end:"2025-05-31" }, link:"https://example.com/p3", contact:"ê²½ë¶ì¼ìë¦¬ì„¼í„°",
        tags:["ì·¨ì—…", "êµìœ¡", "ë©´ì ‘ë¹„"], employment:"êµ¬ì§ì", updatedAt:"2025-01-20" },
      { id:"P004", title:"ì²­ë…„ ì°½ì—… ì‹œë“œ í€ë“œ", region:"ì„œìš¸", category:"ê¸ˆìœµ", host:"ì„œìš¸ì‚°ì—…ì§„í¥ì›",
        targets:"ì˜ˆë¹„/ì´ˆê¸° ì°½ì—…ì", benefit:"ì‹œë“œ íˆ¬ì ìµœëŒ€ 5ì²œë§Œì› + ë³´ìœ¡ í”„ë¡œê·¸ë¨",
        period:{ start:"2025-02-01", end:"2025-12-31" }, link:"https://example.com/p4", contact:"SBA",
        tags:["ì°½ì—…", "íˆ¬ì"], employment:"í”„ë¦¬ëœì„œ/ìì˜ì—…", updatedAt:"2025-02-12" }
    ]);

    // ==========================
    // ğŸ§  State store
    // ==========================
    const Store = (()=>{
      const LS_KEY = 'smp.saved.v1';
      const loadSaved = () => new Set(JSON.parse(localStorage.getItem(LS_KEY) || '[]'));
      const persistSaved = (set) => localStorage.setItem(LS_KEY, JSON.stringify([...set]));

      const state = {
        page: 1,
        pageSize: 6,
        saved: loadSaved(),
        filters: {
          q: '', region: '', category: '',
          ageMin: 0, ageMax: 200,
          income: '', employment: '',
          deadline: 'open', sort: 'relevance'
        }
      };

      const get = () => structuredClone(state);
      const set = (patch) => Object.assign(state, patch);
      const setFilters = (filters) => { state.filters = {...state.filters, ...filters}; };
      const toggleSave = (id) => {
        if (state.saved.has(id)) state.saved.delete(id); else state.saved.add(id);
        persistSaved(state.saved);
      };
      const clearFilters = () => {
        set({ page:1 });
        setFilters({ q:'', region:'', category:'', ageMin:0, ageMax:200, income:'', employment:'', deadline:'open', sort:'relevance' });
      };

      return { get, set, setFilters, toggleSave, clearFilters };
    })();

    // ==========================
    // ğŸ” Filtering & sorting
    // ==========================
    function collectFiltersFromUI(){
      const q  = $('#q').value.trim().toLowerCase();
      const region = $('#region').value;
      const category = $('#category').value;
      const ageMin = parseIntOr($('#ageMin').value || '0', 0);
      const ageMax = parseIntOr($('#ageMax').value || '200', 200);
      const income = $('#income').value;
      const employment = $('#employment').value;
      const deadline = $('#deadline').value || 'open';
      const sort = $('#sort').value || 'relevance';
      return { q, region, category, ageMin, ageMax, income, employment, deadline, sort };
    }

    /** @param {Program[]} all */
    function applyFilters(all){
      const f = Store.get().filters;
      let list = all.slice();

      if (f.q) {
        const q = f.q;
        list = list.filter(p => (
          (p.title+" "+(p.targets||'')+" "+(p.benefit||'')+" "+(p.tags||[]).join(' ')+" "+(p.host||''))
            .toLowerCase().includes(q)
        ));
      }
      if (f.region) list = list.filter(p => p.region === f.region || p.region === 'ì „êµ­');
      if (f.category) list = list.filter(p => p.category === f.category);

      list = list.filter(p => {
        const min = p.minAge ?? 0; const max = p.maxAge ?? 200;
        return f.ageMax >= min && f.ageMin <= max;
      });
      if (f.income) list = list.filter(p => !p.income || p.income === f.income);
      if (f.employment) list = list.filter(p => (p.employment||'') === f.employment);
      if (f.deadline === 'open') list = list.filter(inPeriod);
      if (f.deadline === 'closed') list = list.filter(p => !inPeriod(p));

      if (f.sort === 'deadline') {
        list.sort((a,b)=> new Date(a.period.end) - new Date(b.period.end));
      } else if (f.sort === 'latest') {
        list.sort((a,b)=> new Date(b.updatedAt||b.period.start) - new Date(a.updatedAt||a.period.start));
      }
      // relevance: keep original order for now
      return list;
    }

    function paginate(list){
      const { page, pageSize } = Store.get();
      const start = (page-1)*pageSize;
      return list.slice(start, start+pageSize);
    }

    // ==========================
    // ğŸ–¼ï¸ Rendering
    // ==========================
    function renderChips(){
      const f = Store.get().filters;
      const host = $('#activeChips');
      host.innerHTML = '';
      const add = (label,val) => { if(val){ const el=document.createElement('span'); el.className='chip'; el.textContent=label+': '+val; host.appendChild(el);} };
      add('ì§€ì—­', f.region||'ì „êµ­');
      add('ë¶„ì•¼', f.category||'ì „ì²´');
      if(f.q) add('í‚¤ì›Œë“œ', f.q);
      if(f.ageMin!==0 || f.ageMax!==200) add('ë‚˜ì´', `${f.ageMin}~${f.ageMax===200?'ë¬´í•œ':f.ageMax}`);
      if(f.income) add('ì†Œë“', f.income);
      if(f.employment) add('ê³ ìš©', f.employment);
      add('ë§ˆê°', {open:'ì§„í–‰ì¤‘ë§Œ', all:'ì „ì²´', closed:'ë§ˆê°ë§Œ'}[f.deadline]);
    }

    /** @param {Program[]} list */
    function renderList(list){
      $('#count').textContent = `ê²€ìƒ‰ ê²°ê³¼ ${list.length}ê±´`;
      const host = $('#results');
      host.innerHTML = '';
      const pageList = paginate(list);

      if (!pageList.length){
        $('#empty').hidden = false;
        $('#pager').innerHTML='';
        return;
      }
      $('#empty').hidden = true;

      const saved = Store.get().saved;
      const frag = document.createDocumentFragment();

      for (const p of pageList){
        const live = inPeriod(p);
        const article = document.createElement('article');
        article.className = 'card';
        article.innerHTML = `
          <div class="row"><div class="badge">${p.region}</div><div class="badge">${p.category}</div></div>
          <div class="title">${p.title}</div>
          <div class="muted">${p.host||''}</div>
          <div class="desc">${p.benefit||''}</div>
          <div class="muted">ëŒ€ìƒ: ${p.targets||'-'}${p.income? ' Â· '+p.income:''}</div>
          <div class="period">ì‹ ì²­ê¸°ê°„: ${fmtDate(p.period.start)} ~ ${fmtDate(p.period.end)} ${live? '<span class="live">â— ì§„í–‰ì¤‘</span>':'<span style="color:#9aa8bb">ë§ˆê°</span>'}</div>
          <div class="badges">${(p.tags||[]).map(t=>`<span class="badge">#${t}</span>`).join('')}</div>
          <div class="row">
            <div style="display:flex;gap:8px">
              <button class="btn small" data-act="detail" data-id="${p.id}">ìì„¸íˆ</button>
              <a class="btn small ghost" href="${p.link}" target="_blank" rel="noopener">ê³µì‹ ì‚¬ì´íŠ¸</a>
            </div>
            <button class="btn small ${saved.has(p.id)? 'acc':''}" data-act="save" data-id="${p.id}">${saved.has(p.id)? 'ì €ì¥ë¨â˜…':'ì €ì¥'}</button>
          </div>
        `;
        frag.appendChild(article);
      }
      host.appendChild(frag);

      renderPager(list.length);
    }

    function renderPager(total){
      const { pageSize, page } = Store.get();
      const pages = Math.max(1, Math.ceil(total / pageSize));
      const pager = $('#pager');
      pager.innerHTML = '';
      const frag = document.createDocumentFragment();

      for (let i=1;i<=pages;i++){
        const btn=document.createElement('button');
        btn.type='button';
        btn.className='page'+(i===page?' active':'');
        btn.textContent=String(i);
        btn.dataset.page = String(i);
        frag.appendChild(btn);
      }
      pager.appendChild(frag);
    }

    function openDetail(id){
      const p = DATA.find(x=>x.id===id); if(!p) return;
      $('#detailTitle').textContent = p.title;
      $('#detailBody').innerHTML = `
        <div class="grid">
          <div>
            <h3>ê°œìš”</h3>
            <p class="muted">ì£¼ê´€: ${p.host || '-'}</p>
            <p>ëŒ€ìƒ: ${p.targets || '-'}</p>
            <p>ë¶„ì•¼/ì§€ì—­: ${p.category} Â· ${p.region}</p>
            <p>ì‹ ì²­ê¸°ê°„: ${fmtDate(p.period.start)} ~ ${fmtDate(p.period.end)} ${inPeriod(p)? '<span class="live">ì§„í–‰ì¤‘</span>':'<span style="color:#9aa8bb">ë§ˆê°</span>'}</p>
          </div>
          <div>
            <h3>ì§€ì› ë‚´ìš©</h3>
            <p>${p.benefit || '-'}</p>
            <div class="chiprow" style="margin-top:8px">${(p.tags||[]).map(t=>`<span class='chip'>#${t}</span>`).join('')}</div>
          </div>
        </div>
        <hr style="border-color:#203045;opacity:.4;margin:16px 0">
        <p><strong>ì‹ ì²­/ì•ˆë‚´:</strong> <a href="${p.link}" target="_blank" rel="noopener">ê³µì‹ í˜ì´ì§€</a></p>
        <p><strong>ë¬¸ì˜:</strong> ${p.contact || '-'}</p>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn acc" data-act="save" data-id="${p.id}">${Store.get().saved.has(p.id)? 'ì €ì¥ë¨â˜…':'ì €ì¥'}</button>
          <button class="btn ghost" data-act="copy" data-url="${p.link}">ë§í¬ ë³µì‚¬</button>
        </div>
      `;
      $('#backdrop').style.display='flex';
      $('#backdrop').setAttribute('aria-hidden','false');
    }
    function closeDetail(){
      $('#backdrop').style.display='none';
      $('#backdrop').setAttribute('aria-hidden','true');
    }

    // ==========================
    // ğŸ”— URL sync (optional)
    // ==========================
    function syncToURL(){
      const f = Store.get().filters;
      const usp = new URLSearchParams();
      Object.entries(f).forEach(([k,v])=>{ if(v!=='' && v!==null && v!==undefined && !(k==='ageMin' && v===0) && !(k==='ageMax' && v===200)) usp.set(k, String(v)); });
      usp.set('page', String(Store.get().page));
      history.replaceState(null, '', `${location.pathname}?${usp.toString()}`);
    }
    function initFromURL(){
      const usp = new URLSearchParams(location.search);
      const f = {
        q: usp.get('q')||'',
        region: usp.get('region')||'',
        category: usp.get('category')||'',
        ageMin: parseIntOr(usp.get('ageMin'), 0),
        ageMax: parseIntOr(usp.get('ageMax'), 200),
        income: usp.get('income')||'',
        employment: usp.get('employment')||'',
        deadline: usp.get('deadline')||'open',
        sort: usp.get('sort')||'relevance',
      };
      const page = parseIntOr(usp.get('page'), 1);
      Store.set({ page: clampNum(page,1,999) });
      Store.setFilters(f);

      // Reflect to UI
      $('#q').value=f.q; $('#region').value=f.region; $('#category').value=f.category;
      $('#ageMin').value = f.ageMin ? String(f.ageMin) : '';
      $('#ageMax').value = f.ageMax!==200 ? String(f.ageMax) : '';
      $('#income').value=f.income; $('#employment').value=f.employment; $('#deadline').value=f.deadline; $('#sort').value=f.sort;
    }

    // ==========================
    // ğŸ›ï¸ Event wiring
    // ==========================
    function bindEvents(){
      // Search / reset
      $('#btn-search').addEventListener('click', ()=>{ Store.set({ page:1 }); update(); });
      $('#btn-reset').addEventListener('click', ()=>{ Store.clearFilters(); reflectUIFromStore(); update(); });

      // Saved view
      $('#btn-saved').addEventListener('click', ()=>{
        const saved = DATA.filter(m=>Store.get().saved.has(m.id));
        $('#results').innerHTML='';
        renderList(saved);
        $('#count').textContent = `ì €ì¥í•œ í•­ëª© ${saved.length}ê±´`;
        $('#pager').innerHTML='';
        const pressed = $('#btn-saved').getAttribute('aria-pressed') === 'true';
        $('#btn-saved').setAttribute('aria-pressed', String(!pressed));
      });

      // Debounced change handlers on form inputs
      const onFilterChange = debounce(()=>{ Store.set({ page:1 }); Store.setFilters(collectFiltersFromUI()); update(); }, 200);
      $$('#filters input, #filters select, #sort').forEach(el=>{
        el.addEventListener('input', onFilterChange);
        el.addEventListener('change', onFilterChange);
      });

      // Results delegation
      $('#results').addEventListener('click', (e)=>{
        const btn = e.target.closest('button'); if(!btn) return;
        const id = btn.dataset.id;
        const act = btn.dataset.act;
        if (act==='detail') openDetail(id);
        if (act==='save') { Store.toggleSave(id); update(); }
      });

      // Pager
      $('#pager').addEventListener('click', (e)=>{
        const btn = e.target.closest('button.page'); if(!btn) return;
        const to = parseInt(btn.dataset.page,10);
        Store.set({ page: to }); update(false); window.scrollTo({top:0,behavior:'smooth'});
      });

      // Modal
      $('#closeDetail').addEventListener('click', closeDetail);
      $('#backdrop').addEventListener('click', (e)=>{ if(e.target.id==='backdrop') closeDetail(); });
      $('#detailBody').addEventListener('click', async (e)=>{
        const btn = e.target.closest('button'); if(!btn) return;
        if (btn.dataset.act==='save') { Store.toggleSave(btn.dataset.id); update(false); openDetail(btn.dataset.id); }
        if (btn.dataset.act==='copy') { try{ await navigator.clipboard.writeText(btn.dataset.url); alert('ë§í¬ ë³µì‚¬ë¨'); } catch { alert('ë³µì‚¬ ì‹¤íŒ¨'); } }
      });
    }

    function reflectUIFromStore(){
      const f = Store.get().filters;
      $('#q').value=f.q; $('#region').value=f.region; $('#category').value=f.category;
      $('#ageMin').value = f.ageMin ? String(f.ageMin) : '';
      $('#ageMax').value = f.ageMax!==200 ? String(f.ageMax) : '';
      $('#income').value=f.income; $('#employment').value=f.employment; $('#deadline').value=f.deadline; $('#sort').value=f.sort;
    }

    // ==========================
    // ğŸ” Main update loop
    // ==========================
    function update(syncUrl=true){
      const filtered = applyFilters(DATA);
      renderChips();
      renderList(filtered);
      $('#btn-saved').textContent = `ì €ì¥í•¨(${Store.get().saved.size})`;
      if (syncUrl) syncToURL();
    }

    // ==========================
    // ğŸš€ Init
    // ==========================
    initFromURL();
    bindEvents();
    update();

    // ==========================
    // ğŸ“Œ API Hook (Replace later)
    //  - applyFilters() ìë¦¬ì— ì¿¼ë¦¬ìŠ¤íŠ¸ë§ êµ¬ì„± í›„ /search API í˜¸ì¶œ
    //  - page, pageSize, sort í¬í•¨
    //  - ì‘ë‹µì„ Program[] ìŠ¤í‚¤ë§ˆì— ë§¤í•‘
    // ==========================
  </script>
</body>
</html> -->
