<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë§ì¶¤í˜• ì§€ì›ì‚¬ì—… í”Œë«í¼</title>
  <link rel="stylesheet" href="./smp.css" />
</head>

<body>
  <!-- ================= í—¤ë” ================= -->
  <header>
    <div class="nav">
      <button class="menu-toggle" id="menuToggle">â˜°</button>
      <div class="brand"><span class="dot"></span>ë§ì¶¤í˜• ì§€ì›ì‚¬ì—… í”Œë«í¼</div>
      <div class="actions">
        <button class="btn ghost small" id="btn-saved">ì €ì¥í•¨(0)</button>
        <button class="btn small" id="btn-reset">ì´ˆê¸°í™”</button>
        <button class="btn acc small" id="btn-search">ê²€ìƒ‰</button>
        <div class="auth">
          <button class="btn ghost small" id="authBtn">ë¡œê·¸ì¸</button>
          <div id="authMenu" class="auth-menu">
            <a id="myPageLink" href="../mypage.html"
              style="display:none">ë§ˆì´í˜ì´ì§€</a>
            <button id="logoutBtn" type="button"
              style="display:none">ë¡œê·¸ì•„ì›ƒ</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ================= ì „ì²´ ë ˆì´ì•„ì›ƒ ================= -->
  <div class="layout">
    <!-- ===== ì‚¬ì´ë“œë°” ===== -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <h3>ì¹´í…Œê³ ë¦¬</h3>
        <div class="menu-item active"><span>ì „ì²´</span><span
            class="count">0</span></div>
        <div class="menu-item"><span>ì£¼ê±°</span><span class="count">0</span></div>
        <div class="menu-item"><span>ì¼ìë¦¬</span><span class="count">0</span>
        </div>
        <div class="menu-item"><span>êµìœ¡</span><span class="count">0</span></div>
        <div class="menu-item"><span>ê¸ˆìœµ</span><span class="count">0</span></div>
        <div class="menu-item"><span>ë³µì§€</span><span class="count">0</span></div>
      </div>

      <div class="sidebar-section">
        <h3>ìµœê·¼ ë³¸ ì§€ì›ì‚¬ì—…</h3>
        <div class="muted" style="text-align:center">ìµœê·¼ ë³¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>

      <div class="sidebar-section">
        <h3>ìœ ìš©í•œ ë§í¬</h3>
        <a class="menu-item" href="../faq.html"><span>ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</span></a>
        <a class="menu-item" href="../guide.html"><span>ì´ìš© ê°€ì´ë“œ</span></a>
        <a class="menu-item" href="../contact.html"><span>ë¬¸ì˜í•˜ê¸°</span></a>
      </div>
    </aside>

    <!-- ===== ë©”ì¸ ì½˜í…ì¸  ===== -->
    <main class="main-content">
      <section class="hero container">
        <h1>ë‹¹ì‹ ì—ê²Œ ë§ëŠ” ì§€ì›ì‚¬ì—…ì„ í•œëˆˆì—</h1>
        <p class="muted">í‚¤ì›Œë“œì™€ ì¡°ê±´ì„ ì„ íƒí•´ ë³´ì„¸ìš”.</p>

        <!-- ì¸ê¸° ê²€ìƒ‰ íƒœê·¸ -->
        <div style="margin-bottom:16px">
          <div
            style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
            <div style="font-weight:600;color:#adc0d4">ì¸ê¸° ê²€ìƒ‰</div>
            <div class="chiprow" id="popularTags"></div>
          </div>
        </div>

        <!-- ê²€ìƒ‰ í•„í„° -->
        <div class="filters" id="filters">
          <!-- ğŸ” ì²« ì¤„ : í‚¤ì›Œë“œ / ì§€ì—­ / ë¶„ì•¼ -->
          <div class="f" style="grid-column: span 6">
            <label for="keyword">í‚¤ì›Œë“œ</label>
            <input class="input" id="keyword" placeholder="ì˜ˆ: ì „ì„¸ìê¸ˆ, ì°½ì—…, êµìœ¡" />
          </div>
          <div class="f" style="grid-column: span 3">
            <label>ì§€ì—­</label>
            <select class="select" id="region">
              <option value="">ì „êµ­</option>
              <option>ì„œìš¸</option>
              <option>ë¶€ì‚°</option>
              <option>ëŒ€êµ¬</option>
              <option>ì¸ì²œ</option>
              <option>ê´‘ì£¼</option>
              <option>ëŒ€ì „</option>
              <option>ìš¸ì‚°</option>
              <option>ì„¸ì¢…</option>
              <option>ê²½ê¸°</option>
              <option>ê°•ì›</option>
              <option>ì¶©ë¶</option>
              <option>ì¶©ë‚¨</option>
              <option>ì „ë¶</option>
              <option>ì „ë‚¨</option>
              <option>ê²½ë¶</option>
              <option>ê²½ë‚¨</option>
              <option>ì œì£¼</option>
            </select>
          </div>
          <div class="f" style="grid-column: span 3">
            <label>ë¶„ì•¼</label>
            <select class="select" id="category">
              <option value="">ì „ì²´</option>
              <option>ì£¼ê±°</option>
              <option>ì¼ìë¦¬</option>
              <option>êµìœ¡</option>
              <option>ê¸ˆìœµ</option>
              <option>ë³µì§€</option>
            </select>
          </div>

          <!-- ğŸ•’ ë§ˆê° ì—¬ë¶€ -->
          <div class="f" style="grid-column: span 3">
            <label>ë§ˆê°ì—¬ë¶€</label>
            <select class="select" id="deadline">
              <option value="open">ì§„í–‰ì¤‘ë§Œ</option>
              <option value="all">ì „ì²´</option>
              <option value="closed">ë§ˆê°ë§Œ</option>
            </select>
          </div>

          <!-- ğŸ‘¤ ë‚˜ì´ / ì†Œë“ / ê³ ìš© / ì„±ë³„ -->
          <div class="f" style="grid-column: span 3">
            <label>ë‚˜ì´(ë§Œ ê¸°ì¤€)</label>
            <div style="display:flex;gap:8px;">
              <input class="input" id="ageMin" placeholder="ìµœì†Œ" type="number" />
              <input class="input" id="ageMax" placeholder="ìµœëŒ€" type="number" />
            </div>
          </div>
          <div class="f" style="grid-column: span 3">
            <label>ì†Œë“êµ¬ê°„</label>
            <select class="select" id="income">
              <option value="">ë¬´ê´€</option>
              <option>ì €ì†Œë“ì¸µ</option>
              <option>ì¤‘ìœ„ì†Œë“ ì´í•˜</option>
              <option>ì¤‘ì‚°ì¸µ</option>
              <option>ê³ ì†Œë“ì¸µ</option>
            </select>
          </div>
          <div class="f" style="grid-column: span 3">
            <label>ê³ ìš©ìƒíƒœ</label>
            <select class="select" id="employment">
              <option value="">ë¬´ê´€</option>
              <option>ì¬ì§ì</option>
              <option>êµ¬ì§ì</option>
              <option>ìì˜ì—…ì</option>
              <option>í•™ìƒ</option>
            </select>
          </div>
          <div class="f" style="grid-column: span 3">
            <label>ì„±ë³„</label>
            <select class="select" id="gender">
              <option value="">ë¬´ê´€</option>
              <option>ë‚¨ì„±</option>
              <option>ì—¬ì„±</option>
            </select>
          </div>

          <!-- ğŸ’° ì¬ì‚° -->
          <div class="f" style="grid-column: span 3">
            <label>ì¬ì‚°(ì›)</label>
            <input class="input" id="asset" placeholder="ì˜ˆ: 1000000"
              type="number" />
          </div>

          <!-- ğŸ¯ ê´€ì‹¬ë¶„ì•¼ -->
          <div class="f" style="grid-column: span 9">
            <label>ê´€ì‹¬ë¶„ì•¼ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
            <input class="input" id="interests" placeholder="ì˜ˆ: ì°½ì—…, ì£¼ê±°, êµìœ¡" />
          </div>

          <!-- ğŸ’¾ ì¡°ê±´ ì €ì¥ / ë¶ˆëŸ¬ì˜¤ê¸° / ê²€ìƒ‰ -->
          <div class="f"
            style="grid-column: span 12; text-align:center; margin-top:12px;">
            <button class="btn small" id="btn-save-condition">ğŸ’¾ ì¡°ê±´ ì €ì¥</button>
            <button class="btn small ghost" id="btn-load-condition">ğŸ“‚ ë‚´ ì¡°ê±´
              ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="btn small acc" id="btn-search-run">ğŸ” ê²€ìƒ‰ ì‹¤í–‰</button>
            <button class="btn small ghost" id="btn-clear">â™»ï¸ ì¡°ê±´ ì´ˆê¸°í™”</button>
          </div>
        </div>

      </section>

      <!-- ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ -->
      <section class="container">
        <div class="toolbar">
          <div id="count" class="muted">ê²€ìƒ‰ ê²°ê³¼ 0ê±´</div>
          <div>
            <select class="select" id="sort">
              <option value="relevance">ì •í™•ë„ìˆœ</option>
              <option value="latest">ìµœì‹  ë“±ë¡ìˆœ</option>
            </select>
          </div>
        </div>

        <div class="results" id="results"></div>
        <div class="empty" id="empty" style="display:none">ì¡°ê±´ì— ë§ëŠ” ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </section>

      <footer class="container">Â© 2025 ë§ì¶¤í˜• ì§€ì›ì‚¬ì—… í”Œë«í¼</footer>
    </main>
  </div>

  <!-- ================= ìŠ¤í¬ë¦½íŠ¸ ================= -->
  <script>
    let allPrograms = [];

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë¶ˆëŸ¬ì˜¤ê¸°
    window.addEventListener("DOMContentLoaded", async () => {
      await loadPrograms();
      document.getElementById("btn-search-run").addEventListener("click", runSearch);
      document.getElementById("btn-clear").addEventListener("click", clearFilters);

      // âœ… ì—”í„°í‚¤ë¡œ ê²€ìƒ‰ ì‹¤í–‰ ê¸°ëŠ¥ ì¶”ê°€
      document.getElementById("keyword").addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          runSearch();
        }
      });
      document.getElementById("region").addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          runSearch();
        }
      });
      document.getElementById("category").addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          runSearch();
        }
      });
      document.getElementById("deadline").addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          runSearch();
        }
      });
    });

    // API í˜¸ì¶œ
    async function loadPrograms() {
      try {
        console.log("ğŸ“¡ ë³µì§€ë¡œ API í˜¸ì¶œ ì¤‘...");
        const response = await fetch("http://localhost:8080/api/welfare?page=1&perPage=1000");
        if (!response.ok) throw new Error("API ì˜¤ë¥˜: " + response.status);

        const data = await response.json();
        const list = data.data || [];

        allPrograms = list.map((item, i) => ({
          id: "W" + (i + 1),
          title: item["ì„œë¹„ìŠ¤ëª…"] || "ì œëª© ì—†ìŒ",
          host: item["ì†Œê´€ë¶€ì²˜ëª…"] || "ê¸°ê´€ ë¯¸ìƒ",
          category: "ë³µì§€",
          region: "ì „êµ­",
          benefit: item["ì„œë¹„ìŠ¤ìƒì„¸"] || "",
          targets: item["ì„œë¹„ìŠ¤ìš”ì•½"] || "",
          link: item["ì„œë¹„ìŠ¤URL"] || "#",
          start: "2025-01-01",
          end: "2025-12-31",
        }));

        renderResults(allPrograms);
      } catch (err) {
        console.error("âŒ API í˜¸ì¶œ ì‹¤íŒ¨:", err);
      }
    }

    // ê²€ìƒ‰ ì¡°ê±´ ì ìš©
    function runSearch() {
      const keyword = document.getElementById("keyword").value.trim();
      const region = document.getElementById("region").value;
      const category = document.getElementById("category").value;
      const deadline = document.getElementById("deadline").value;

      const filtered = allPrograms.filter((p) => {
        const matchKeyword =
          !keyword ||
          p.title.includes(keyword) ||
          p.targets.includes(keyword) ||
          p.benefit.includes(keyword);
        const matchRegion = !region || p.region === region;
        const matchCategory = !category || p.category === category;
        const matchDeadline =
          deadline === "all" || deadline === "open" ? true : false;

        return matchKeyword && matchRegion && matchCategory && matchDeadline;
      });

      renderResults(filtered);
    }

    // ì´ˆê¸°í™”
    function clearFilters() {
      document.getElementById("keyword").value = "";
      document.getElementById("region").value = "";
      document.getElementById("category").value = "";
      document.getElementById("deadline").value = "open";
      renderResults(allPrograms);
    }

    // ê²°ê³¼ ë Œë”ë§
    function renderResults(list) {
      const container = document.getElementById("results");
      const countEl = document.getElementById("count");
      const emptyEl = document.getElementById("empty");
      container.innerHTML = "";

      if (!list || list.length === 0) {
        emptyEl.style.display = "block";
        countEl.innerText = "ê²€ìƒ‰ ê²°ê³¼ 0ê±´";
        return;
      }

      emptyEl.style.display = "none";
      countEl.innerText = `ê²€ìƒ‰ ê²°ê³¼ ${list.length}ê±´`;

      list.forEach((item) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
        <div class="card-body">
          <h3>${item.title}</h3>
          <p class="muted">${item.region} Â· ${item.category}</p>
          <p>${item.benefit}</p>
          <p><small>ëŒ€ìƒ: ${item.targets}</small></p>
          <p><small>ê¸°ê´€: ${item.host}</small></p>
          <a href="${item.link}" target="_blank" class="btn small" 
          onclick='saveRecentProgram(${JSON.stringify(item)})'>ìì„¸íˆ ë³´ê¸°</a>

        </div>
      `;
        container.appendChild(card);
      });
    }


  </script>

  <!-- âœ… ì—¬ê¸°ì— ìƒˆ ì½”ë“œ ì¶”ê°€ -->
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const saveBtn = document.getElementById("btn-save-condition");
      const loadBtn = document.getElementById("btn-load-condition");

      if (saveBtn && loadBtn) {
        saveBtn.addEventListener("click", () => {
          const condition = {
            keyword: document.getElementById("keyword")?.value || "",
            region: document.getElementById("region")?.value || "",
            category: document.getElementById("category")?.value || "",
            deadline: document.getElementById("deadline")?.value || "",
            ageMin: document.getElementById("ageMin")?.value || "",
            ageMax: document.getElementById("ageMax")?.value || "",
            income: document.getElementById("income")?.value || "",
            employment: document.getElementById("employment")?.value || "",
            gender: document.getElementById("gender")?.value || "",
            asset: document.getElementById("asset")?.value || "",
            interests: document.getElementById("interests")?.value || ""
          };

          localStorage.setItem("savedCondition", JSON.stringify(condition));
          alert("âœ… ê²€ìƒ‰ ì¡°ê±´ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        });

        loadBtn.addEventListener("click", () => {
          const saved = localStorage.getItem("savedCondition");
          if (!saved) {
            alert("âŒ ì €ì¥ëœ ì¡°ê±´ì´ ì—†ìŠµë‹ˆë‹¤.");
            return;
          }

          const c = JSON.parse(saved);
          document.getElementById("keyword").value = c.keyword || "";
          document.getElementById("region").value = c.region || "";
          document.getElementById("category").value = c.category || "";
          document.getElementById("deadline").value = c.deadline || "";
          document.getElementById("ageMin").value = c.ageMin || "";
          document.getElementById("ageMax").value = c.ageMax || "";
          document.getElementById("income").value = c.income || "";
          document.getElementById("employment").value = c.employment || "";
          document.getElementById("gender").value = c.gender || "";
          document.getElementById("asset").value = c.asset || "";
          document.getElementById("interests").value = c.interests || "";

          alert("ğŸ”„ ì €ì¥ëœ ì¡°ê±´ì´ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤.");
        });
      }
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const sidebar = document.querySelector(".sidebar");
      const toggleBtn = document.getElementById("menuToggle");

      // ğŸ“Œ ë°±ë“œë¡­(ë°°ê²½ ì–´ë‘¡ê²Œ) ìš”ì†Œ ë§Œë“¤ê¸°
      let backdrop = document.createElement("div");
      backdrop.classList.add("backdrop-sidebar");
      document.body.appendChild(backdrop);

      // â˜° í´ë¦­ ì‹œ ì—´ê¸°/ë‹«ê¸°
      toggleBtn.addEventListener("click", () => {
        const isActive = sidebar.classList.toggle("active");
        backdrop.classList.toggle("active", isActive);
      });

      // ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      backdrop.addEventListener("click", () => {
        sidebar.classList.remove("active");
        backdrop.classList.remove("active");
      });

      // âœ… ë°˜ì‘í˜• ëŒ€ì‘: ì°½ í¬ê¸° ì»¤ì§€ë©´ ìë™ ë‹«ê¸°
      window.addEventListener("resize", () => {
        if (window.innerWidth > 1000) {
          sidebar.classList.remove("active");
          backdrop.classList.remove("active");
        }
      });
    });
  </script>

  <script>
    // ======================
    // ğŸ¯ ì¹´í…Œê³ ë¦¬ + ìµœê·¼ ë³¸ í•­ëª© ê¸°ëŠ¥
    // ======================
    document.addEventListener("DOMContentLoaded", () => {
      const categoryItems = document.querySelectorAll(".sidebar .menu-item");
      const recentContainer = document.querySelector(".sidebar-section:nth-of-type(2)");

      // âœ… 1. ì¹´í…Œê³ ë¦¬ í´ë¦­ ì‹œ ìë™ í•„í„°ë§
      categoryItems.forEach((item) => {
        item.addEventListener("click", () => {
          // ê¸°ì¡´ ì„ íƒ ìŠ¤íƒ€ì¼ ì œê±° í›„ í˜„ì¬ë§Œ í™œì„±í™”
          categoryItems.forEach((el) => el.classList.remove("active"));
          item.classList.add("active");

          const category = item.querySelector("span").innerText.trim();
          const selectEl = document.getElementById("category");
          selectEl.value = category === "ì „ì²´" ? "" : category;

          // ê¸°ì¡´ runSearch() í•¨ìˆ˜ í˜¸ì¶œ
          if (typeof runSearch === "function") {
            runSearch();
          }
        });
      });

      // âœ… 2. ìµœê·¼ ë³¸ ì§€ì›ì‚¬ì—… ì €ì¥ í•¨ìˆ˜ (ì „ì—­ìœ¼ë¡œ ì„ ì–¸ë˜ì–´ì•¼ í•¨)
      window.saveRecentProgram = function (program) {
        let recent = JSON.parse(localStorage.getItem("recentPrograms") || "[]");

        // ì´ë¯¸ ìˆìœ¼ë©´ ì œê±°í•˜ê³  ë‹¤ì‹œ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
        recent = recent.filter((p) => p.id !== program.id);
        recent.unshift(program);
        if (recent.length > 5) recent.pop(); // ìµœê·¼ 5ê°œê¹Œì§€ë§Œ ìœ ì§€

        localStorage.setItem("recentPrograms", JSON.stringify(recent));
        renderRecentPrograms();
      };

      // âœ… 3. ìµœê·¼ ë³¸ ì§€ì›ì‚¬ì—… í‘œì‹œ
      function renderRecentPrograms() {
        const recent = JSON.parse(localStorage.getItem("recentPrograms") || "[]");
        const targetDiv = recentContainer.querySelector(".muted");

        if (recent.length === 0) {
          targetDiv.innerHTML = "ìµœê·¼ ë³¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤";
          return;
        }

        // ëª©ë¡ ë Œë”ë§
        targetDiv.innerHTML = recent.map(
          (p) => `<div class="menu-item"><a href="${p.link}" target="_blank">${p.title}</a></div>`
        ).join("");
      }

      // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ìµœê·¼ ë³¸ í•­ëª© í‘œì‹œ
      renderRecentPrograms();
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const authBtn = document.getElementById("authBtn");

      if (authBtn) {
        authBtn.addEventListener("click", () => {
          // ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ìƒˆ ì°½ìœ¼ë¡œ ì—´ê¸° (íŒì—… ë°©ì‹)
          window.open("../login.html", "loginWindow", "width=480,height=600");

        });
      }

      // âœ… ë¡œê·¸ì¸ ì™„ë£Œ í›„ ëŒì•„ì™”ì„ ë•Œ ì‚¬ìš©ì ì •ë³´ ë°›ê¸°
      window.addEventListener("message", (event) => {
        if (event.data?.type === "auth:login") {
          const user = event.data.user;
          localStorage.setItem("SMP_LOGGED_USER", JSON.stringify(user));
          updateAuthUI(user);
        }
      });

      // âœ… ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ UI ê°±ì‹ 
      function updateAuthUI(user) {
        const authBtn = document.getElementById("authBtn");
        const myPageLink = document.getElementById("myPageLink");
        // âœ… ë§ˆì´í˜ì´ì§€ ì´ë™ ê¸°ëŠ¥ ì¶”ê°€
        if (myPageLink) {
          myPageLink.addEventListener("click", (e) => {
            e.preventDefault();
            window.location.href = "../mypage.html";
          });
        }
        const logoutBtn = document.getElementById("logoutBtn");

        if (user) {
          authBtn.style.display = "none";
          myPageLink.style.display = "block";
          logoutBtn.style.display = "block";
        } else {
          authBtn.style.display = "block";
          myPageLink.style.display = "none";
          logoutBtn.style.display = "none";
        }
      }

      // âœ… ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì‹œ
      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
          localStorage.removeItem("SMP_LOGGED_USER");
          updateAuthUI(null);
          alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
        });
      }

      // âœ… ìƒˆë¡œê³ ì¹¨ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ ë³µì›
      const savedUser = JSON.parse(localStorage.getItem("SMP_LOGGED_USER") || "null");
      if (savedUser) updateAuthUI(savedUser);
    });
  </script>

  <link rel="stylesheet" href="./smp.css" />
  <script src="./app.js"></script>

</body>

</html>